
# pylint: disable=missing-docstring

import unittest
from chewie.eap import Eap, EapIdentity, EapMd5Challenge, EapSuccess, EapFailure, EapPEAP


class EapTestCase(unittest.TestCase):
    def test_eap_identity_parses(self):
        packed_message = bytes.fromhex("0101000501")
        message = Eap.parse(packed_message)
        self.assertEqual(message.packet_id, 1)
        self.assertEqual(message.identity, "")

    def test_eap_md5_challenge_parses(self):
        packed_message = bytes.fromhex(
            "0201002204103a535f0ee8c6b34fe714aa7dad9a0e154a6f686e2e4d63477569726b")
        message = Eap.parse(packed_message)
        self.assertEqual(message.packet_id, 1)
        self.assertEqual(message.challenge, bytes.fromhex("3a535f0ee8c6b34fe714aa7dad9a0e15"))
        self.assertEqual(message.extra_data, b"John.McGuirk")

    def test_eap_identity_packs(self):
        expected_packed_message = bytes.fromhex("0101000501")
        eap = EapIdentity(Eap.REQUEST, 1, "")
        packed_message = eap.pack()
        self.assertEqual(expected_packed_message, packed_message)

    def test_eap_md5_challenge_packs(self):
        expected_packed_message = bytes.fromhex(
            "0201002204103a535f0ee8c6b34fe714aa7dad9a0e154a6f686e2e4d63477569726b")
        eap = EapMd5Challenge(Eap.RESPONSE,
                              1,
                              bytes.fromhex("3a535f0ee8c6b34fe714aa7dad9a0e15"),
                              b"John.McGuirk")
        packed_message = eap.pack()
        self.assertEqual(expected_packed_message, packed_message)

    def test_eap_success_parses(self):
        packed_message = bytes.fromhex("03010004")
        message = Eap.parse(packed_message)
        self.assertEqual(message.packet_id, 1)
        self.assertTrue(isinstance(message, EapSuccess))

    def test_eap_failure_parses(self):
        packed_message = bytes.fromhex("04010004")
        message = Eap.parse(packed_message)
        self.assertEqual(message.packet_id, 1)
        self.assertTrue(isinstance(message, EapFailure))

    def test_eap_peap_packs(self):
        expected_packed_message = bytes.fromhex('016d03f019406bb0a78e6438335d6ea7886d5efd66d341723941159e813486e416540090109126ce00f0ae533a15320c37bb2878c2902289e6d5b75aee3532f1f853561935edc413402332a8cb43e74b81cdb9e18e562deb0b27493224ef1a2988b20f6242c25ece6c3ccc5607eafa97182ec085f4d646184e51c545ee0fe37b27fb363601c8279ace789cdcf077ddb51a367e74de41af54b65b2fdeec9919de7cff4af6068b3b5c31d322f835f7045fb3bf5eb1255418087337ce93f530163595f59d70b3fa477f3e2ab281c5872011508bb0dc2d539312ac28b49cbcf1ce2e84c674e29e3d5b228a1f1155aaf290d304e79100061b30820617308203ffa00302010202147ed6e79cc9ad81c4c8193ef95d4428770e341317300d06092a864886f70d01010b05003048310b300906035504061302424d31193017060355040a131051756f5661646973204c696d69746564311e301c0603550403131551756f566164697320526f6f742043412032204733301e170d3132313130363134353031385a170d3232313130363134353031385a304d310b300906035504061302424d31193017060355040a131051756f5661646973204c696d69746564312330210603550403131a51756f566164697320476c6f62616c2053534c2049434120473330820222300d06092a864886f70d01010105000382020f003082020a0282020100d7fc39dd7b6dee9cea54c62438445e99a44ece32437f51af9549c817960a0d3a9d24bbd6ceb1177b19bca715d0c6d7957098336657edc3536c9f3582ceee0ec285a7ebca1329a22b212223648898eb4408d9d283e4554789e9ff1cff5250b4c85522b07ef9719b09f13d6990631f884a2e47410ceced2e160a1ba117d43f9f364d35b2d05ef29d203a61f18a9ca8f4385c192661875642ecd557af5a3863dd1d5fb0f6a71f4e4fe66a1e3c59e941d8f51687e84b150767473b541fac52299ba079bfb87358d4b3ac93beea892b950b9ff2add837d8411f3ff9b12584f8affe54883ed56a1c92cde647cd9d8e89b426d807e07cc377979ee508cdff58f40184c00f4b58f3904fbb3236a33367f469972d8a65b81dab2b8fc0109df01d1ea65e85b86d5da0257df344cc276934ae7ce28093551ecd511f62645c7cdebb93aa9a3e19c2cffe2498aa133883b7f2e39b0d854f884be71ad37cdbc539774d3964a1f5ee9c8e41c71137d1e1924290d9e7e89425c10e02e54aae56287056c1dca178e61c1c6f33d64350dc3b68c501aa4eb50cde4be319c99cd3d98b1e27c8501cabbc62b5d95b029a35fca5f241641d4043202a30344a19bc1c11090a7cb20a8be98459cb4b83246c669c2d9ed0154a4a3708be6abf091587ef289393d7969bbdf1aec83d888c83fe4c091272f2224f2d')
        eap = EapPEAP(Eap.REQUEST,
                      109,
                      0x40,
                      bytes.fromhex('6bb0a78e6438335d6ea7886d5efd66d341723941159e813486e416540090109126ce00f0ae533a15320c37bb2878c2902289e6d5b75aee3532f1f853561935edc413402332a8cb43e74b81cdb9e18e562deb0b27493224ef1a2988b20f6242c25ece6c3ccc5607eafa97182ec085f4d646184e51c545ee0fe37b27fb363601c8279ace789cdcf077ddb51a367e74de41af54b65b2fdeec9919de7cff4af6068b3b5c31d322f835f7045fb3bf5eb1255418087337ce93f530163595f59d70b3fa477f3e2ab281c5872011508bb0dc2d539312ac28b49cbcf1ce2e84c674e29e3d5b228a1f1155aaf290d304e79100061b30820617308203ffa00302010202147ed6e79cc9ad81c4c8193ef95d4428770e341317300d06092a864886f70d01010b05003048310b300906035504061302424d31193017060355040a131051756f5661646973204c696d69746564311e301c0603550403131551756f566164697320526f6f742043412032204733301e170d3132313130363134353031385a170d3232313130363134353031385a304d310b300906035504061302424d31193017060355040a131051756f5661646973204c696d69746564312330210603550403131a51756f566164697320476c6f62616c2053534c2049434120473330820222300d06092a864886f70d01010105000382020f003082020a0282020100d7fc39dd7b6dee9cea54c62438445e99a44ece32437f51af9549c817960a0d3a9d24bbd6ceb1177b19bca715d0c6d7957098336657edc3536c9f3582ceee0ec285a7ebca1329a22b212223648898eb4408d9d283e4554789e9ff1cff5250b4c85522b07ef9719b09f13d6990631f884a2e47410ceced2e160a1ba117d43f9f364d35b2d05ef29d203a61f18a9ca8f4385c192661875642ecd557af5a3863dd1d5fb0f6a71f4e4fe66a1e3c59e941d8f51687e84b150767473b541fac52299ba079bfb87358d4b3ac93beea892b950b9ff2add837d8411f3ff9b12584f8affe54883ed56a1c92cde647cd9d8e89b426d807e07cc377979ee508cdff58f40184c00f4b58f3904fbb3236a33367f469972d8a65b81dab2b8fc0109df01d1ea65e85b86d5da0257df344cc276934ae7ce28093551ecd511f62645c7cdebb93aa9a3e19c2cffe2498aa133883b7f2e39b0d854f884be71ad37cdbc539774d3964a1f5ee9c8e41c71137d1e1924290d9e7e89425c10e02e54aae56287056c1dca178e61c1c6f33d64350dc3b68c501aa4eb50cde4be319c99cd3d98b1e27c8501cabbc62b5d95b029a35fca5f241641d4043202a30344a19bc1c11090a7cb20a8be98459cb4b83246c669c2d9ed0154a4a3708be6abf091587ef289393d7969bbdf1aec83d888c83fe4c091272f2224f2d'))
        packed_message = eap.pack()
        self.assertEqual(expected_packed_message, packed_message)

    def test_eap_peap_parses(self):
        packed_message = bytes.fromhex("016d03f019406bb0a78e6438335d6ea7886d5efd66d341723941159e813486e416540090109126ce00f0ae533a15320c37bb2878c2902289e6d5b75aee3532f1f853561935edc413402332a8cb43e74b81cdb9e18e562deb0b27493224ef1a2988b20f6242c25ece6c3ccc5607eafa97182ec085f4d646184e51c545ee0fe37b27fb363601c8279ace789cdcf077ddb51a367e74de41af54b65b2fdeec9919de7cff4af6068b3b5c31d322f835f7045fb3bf5eb1255418087337ce93f530163595f59d70b3fa477f3e2ab281c5872011508bb0dc2d539312ac28b49cbcf1ce2e84c674e29e3d5b228a1f1155aaf290d304e79100061b30820617308203ffa00302010202147ed6e79cc9ad81c4c8193ef95d4428770e341317300d06092a864886f70d01010b05003048310b300906035504061302424d31193017060355040a131051756f5661646973204c696d69746564311e301c0603550403131551756f566164697320526f6f742043412032204733301e170d3132313130363134353031385a170d3232313130363134353031385a304d310b300906035504061302424d31193017060355040a131051756f5661646973204c696d69746564312330210603550403131a51756f566164697320476c6f62616c2053534c2049434120473330820222300d06092a864886f70d01010105000382020f003082020a0282020100d7fc39dd7b6dee9cea54c62438445e99a44ece32437f51af9549c817960a0d3a9d24bbd6ceb1177b19bca715d0c6d7957098336657edc3536c9f3582ceee0ec285a7ebca1329a22b212223648898eb4408d9d283e4554789e9ff1cff5250b4c85522b07ef9719b09f13d6990631f884a2e47410ceced2e160a1ba117d43f9f364d35b2d05ef29d203a61f18a9ca8f4385c192661875642ecd557af5a3863dd1d5fb0f6a71f4e4fe66a1e3c59e941d8f51687e84b150767473b541fac52299ba079bfb87358d4b3ac93beea892b950b9ff2add837d8411f3ff9b12584f8affe54883ed56a1c92cde647cd9d8e89b426d807e07cc377979ee508cdff58f40184c00f4b58f3904fbb3236a33367f469972d8a65b81dab2b8fc0109df01d1ea65e85b86d5da0257df344cc276934ae7ce28093551ecd511f62645c7cdebb93aa9a3e19c2cffe2498aa133883b7f2e39b0d854f884be71ad37cdbc539774d3964a1f5ee9c8e41c71137d1e1924290d9e7e89425c10e02e54aae56287056c1dca178e61c1c6f33d64350dc3b68c501aa4eb50cde4be319c99cd3d98b1e27c8501cabbc62b5d95b029a35fca5f241641d4043202a30344a19bc1c11090a7cb20a8be98459cb4b83246c669c2d9ed0154a4a3708be6abf091587ef289393d7969bbdf1aec83d888c83fe4c091272f2224f2d")
        message = Eap.parse(packed_message)
        self.assertEqual(message.packet_id, 109)
        self.assertTrue(isinstance(message, EapPEAP))
